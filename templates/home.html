{% extends 'base.html' %}
{% load static %}
{% block content %}
    <h2 class="lib text-center mt-3" style="color:gray;">Library Management System</h2>
    <div class="container">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active text-danger" data-toggle="tab" href="#tab1">LibraryCard</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-danger" data-toggle="tab" href="#tab2">Book</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-danger" data-toggle="tab" href="#tab3">Student Information</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-danger" data-toggle="tab" href="#tab4">Borrower</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="tab1" class="tab-pane fade show active">
                <table class="table table-dark table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Card Number</th>
                            <th scope="col">Issued Date</th>
                            <th scope="col">Expiration Date</th>
                            <th scope="col">User</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for card in library_card %}
                        <tr>
                            <th scope="row">{{ card.id }}</th>
                            <th scope="row">{{ card.card_number }}</th>
                            <td>{{ card.issued_date }}</td>
                            <td>{{ card.expiration_date }}</td>
                            <td>{{ card.user }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div id="tab2" class="tab-pane fade">
                <table class="table table-dark table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Title</th>
                            <th scope="col">Author</th>
                            <th scope="col">Publication Year</th>
                            <th scope="col">Isbn</th>
                            <th scope="col">Quantity</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for bk in book %}
                        <tr>
                            <th scope="row">{{ bk.id }}</th>
                            <th scope="row">{{ bk.title }}</th>
                            <td>{{ bk.author }}</td>
                            <td>{{ bk.publication_year }}</td>
                            <td>{{ bk.isbn }}</td>
                            <td>{{ bk.quantity }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div id="tab3" class="tab-pane fade">
                <table class="table table-dark table-dark table-bordered">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">User</th>
                            <th scope="col">Student Id</th>
                            <th scope="col">Library Card</th>
                            <th scope="col">Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for bws in student_information %}
                        <tr>
                            <th scope="row">{{ bws.id }}</th>
                            <th scope="row">{{ bws.user }}</th>
                            <th scope="row">{{ bws.user.id }}</th>
                            <td>{{ bws.library_card }}</td>
                            <td>{{ bws.address }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div id="tab4" class="tab-pane fade">
                <table class="table table-dark table-bordered text-center">
                    <thead>
                        <tr>
                            <th scope="col">Id</th>
                            <th scope="col">Book</th>
                            <th scope="col">Book Id</th>
                            <th scope="col">Book Borrower Student</th>
                            <th scope="col">Student Id</th>
                            <th scope="col">Borrow Date</th>
                            <th scope="col">Due Date</th>
                            <th scope="col">Return Date</th>
                            <th scope="col">Created At</th>
                            <th scope="col">Updated At</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for borrow in borrower %}
                        <tr>
                            <tr id="borrowerRow_{{ borrow.id }}">
                            <th scope="row">{{ borrow.id }}</th>
                            <td>{{ borrow.book }}</td>
                            <td>{{ borrow.book.id }}</td>
                            <td>{{ borrow.book_borrower_student }}</td>
                            <th scope="row">{{ borrow.book_borrower_student.user.id }}</th>
                            <td>{{  borrow.borrow_date }}</td>
                            <td>{{ borrow.due_date }}</td>
                            <td>{{ borrow.return_date }}</td>
                            <td>{{ borrow.created_at }}</td>
                            <td>{{ borrow.updated_at }}</td>
                            <td><button type='button' class="btn btn-secondary delete-btn" data-borrower-id="{{ borrow.id }}">Delete</button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <button type="button" class="btn btn-secondary" style="float:right;" data-bs-toggle="modal" data-bs-target="#borrowModal">
                    Create Borrower 
                </button>
            </div>
        </div>
    </div>
    <div id="successMessage" class="alert alert-success" role="alert" style="display: none;"></div> </div>
    <!-- Includes Bootstrap Modal -->
    {% include 'Create_borrower/borrower.html' %}
    <!-- Comment Close -->
    
{% endblock content %}

{% block scripts %}

<script src="{% static 'js/home/table_tab.js' %}"></script> 
<script>
    $(document).ready(function() {
        $('.delete-btn').click(function() {
            // Fetch the borrower ID associated with the clicked button
            var borrowerId = $(this).data('borrower-id');
            console.log('Borrower ID:', borrowerId);
            var csrftoken = $('input[name=csrfmiddlewaretoken]')[0].value;
            var formData = {
                'csrfmiddlewaretoken': csrftoken,
            }
             $.ajax({
                 url: "{% url 'delete' 0 %}".replace('0', borrowerId),
                 headers: {
                    'X-CSRFToken': csrftoken  // Include CSRF token in request headers
                },
                 type: 'DELETE',
                 success: function(response) {
                    $('#successMessage').delay(2000).text(response.message).show().fadeOut('slow');
                    $('#borrowerRow_' + borrowerId).remove();
                 },
                 error: function(xhr, status, error) {
                     // Handle error response
                 }
             });
        });
    });
</script>
{% endblock %}

